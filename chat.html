<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chat with ProjectByAI</title>
<style>
  /* ... your existing styles ... */
  /* Add these new styles for code block & buttons */
  .code-block {
    background: #222;
    color: #0f0;
    padding: 15px;
    border-radius: 10px;
    white-space: pre-wrap;
    font-family: 'Courier New', Courier, monospace;
    max-width: 80vw;
    margin: 10px 0;
    box-shadow: 0 0 10px #0f0;
    position: relative;
  }
  .code-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }
  .code-btn {
    background: #00ffe7;
    border: none;
    padding: 8px 15px;
    border-radius: 30px;
    cursor: pointer;
    font-weight: bold;
    color: #000;
    transition: background-color 0.3s ease;
  }
  .code-btn:hover {
    background-color: #00bfa6;
  }
</style>
</head>
<body>
<header>ðŸ¤– ProjectByAI - Chat Mode</header>
<div class="chat-container" id="chat"></div>
<footer>
  <input type="text" id="user-input" placeholder="Type something..." autocomplete="off" />
  <button class="send-btn" onclick="sendMessage()">Send</button>
  <button class="clear-btn" onclick="clearMemory()">Clear Memory</button>
</footer>
<script>
  const chat = document.getElementById('chat');
  const input = document.getElementById('user-input');
  let userName = localStorage.getItem("userName") || "friend";
  let isDarkTheme = true;

  const htmlScriptCode = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Simple Alert Button</title>
</head>
<body>
  <button onclick="sayHello()">Click Me</button>

  <script>
    function sayHello() {
      alert("Hello!");
    }
  </script>
</body>
</html>`;

  function getBotReply(msg) {
    msg = msg.toLowerCase();
    if (msg.includes("html script")) {
      return { type: "code", content: htmlScriptCode };
    }
    if (msg.includes("hello")) {
      return `Hey ${userName}! Iâ€™m your AI-powered pal. How can I assist you today?`;
    }
    if (msg.includes("make me laugh") || msg.includes("joke")) {
      return "Why donâ€™t scientists trust atoms? Because they make up everything!";
    }
    return "Classic question. Classic answer. Try asking something fun like 'make me laugh' or 'start quiz'!";
  }

  function appendMessage(sender, data, type) {
    const messageDiv = document.createElement("div");
    messageDiv.classList.add("message", type);

    if (type === "bot") {
      const avatar = document.createElement("img");
      avatar.src = "https://api.dicebear.com/7.x/bottts/svg?seed=AmanAI12";
      avatar.alt = "Bot Avatar";
      avatar.className = "bot-avatar";
      if (!isDarkTheme) avatar.classList.add("light");
      messageDiv.appendChild(avatar);

      if (typeof data === "object" && data.type === "code") {
        const codeBlock = document.createElement("pre");
        codeBlock.className = "code-block";
        codeBlock.textContent = data.content;
        messageDiv.appendChild(codeBlock);

        const btnContainer = document.createElement("div");
        btnContainer.className = "code-buttons";

        const copyBtn = document.createElement("button");
        copyBtn.className = "code-btn";
        copyBtn.textContent = "Copy";
        copyBtn.onclick = () => {
          navigator.clipboard.writeText(data.content).then(() => {
            copyBtn.textContent = "Copied!";
            setTimeout(() => (copyBtn.textContent = "Copy"), 1500);
          });
        };
        btnContainer.appendChild(copyBtn);

        const testBtn = document.createElement("button");
        testBtn.className = "code-btn";
        testBtn.textContent = "Test";
        testBtn.onclick = () => {
          const newWindow = window.open();
          newWindow.document.write(data.content);
          newWindow.document.close();
        };
        btnContainer.appendChild(testBtn);

        messageDiv.appendChild(btnContainer);
      } else {
        const textSpan = document.createElement("pre");
        textSpan.innerHTML = data;
        messageDiv.appendChild(textSpan);
      }
    } else {
      messageDiv.innerHTML = `<pre><strong>${sender}:</strong> ${data}</pre>`;
    }

    chat.appendChild(messageDiv);
    chat.scrollTop = chat.scrollHeight;
  }

  function sendMessage() {
    const msg = input.value.trim();
    if (!msg) return;

    appendMessage(userName, msg, "user");
    input.value = "";

    setTimeout(() => {
      const reply = getBotReply(msg);
      appendMessage("Bot", reply, "bot");
      chat.scrollTop = chat.scrollHeight;
    }, 400);
  }

  function clearMemory() {
    if (confirm("Are you sure you want to clear all memory?")) {
      localStorage.clear();
      location.reload();
    }
  }

  input.addEventListener("keypress", e => {
    if (e.key === "Enter") sendMessage();
  });

  appendMessage("Bot", `Welcome back ${userName}! Type 'html script' to see a cool demo with copy & test buttons!`, "bot");
</script>
</body>
</html>
